-- SQL12 连 续 签 到 领 金 币 困 难 通 过 率 ： 31.95 % 时 间 限 制 ： 1 秒 空 间 限 制 ： 256M 描 述 用 户 行 为 日 志 表 tb_user_log id uid artical_id in_time out_time sign_in 1 101 0 2021 -07 -07 10 :00 :00 2021 -07 -07 10 :00 :09 1 2 101 0 2021 -07 -08 10 :00 :00 2021 -07 -08 10 :00 :09 1 3 101 0 2021 -07 -09 10 :00 :00 2021 -07 -09 10 :00 :42 1 4 101 0 2021 -07 -10 10 :00 :00 2021 -07 -10 10 :00 :09 1 5 101 0 2021 -07 -11 23 :59 :55 2021 -07 -11 23 :59 :59 1 6 101 0 2021 -07 -12 10 :00 :28 2021 -07 -12 10 :00 :50 1 7 101 0 2021 -07 -13 10 :00 :28 2021 -07 -13 10 :00 :50 1 8 102 0 2021 -10 -01 10 :00 :28 2021 -10 -01 10 :00 :50 1 9 102 0 2021 -10 -02 10 :00 :01 2021 -10 -02 10 :01 :50 1 10 102 0 2021 -10 -03 10 :00 :55 2021 -10 -03 11 :00 :59 1 11 102 0 2021 -10 -04 10 :00 :45 2021 -10 -04 11 :00 :55 0 12 102 0 2021 -10 -05 10 :00 :53 2021 -10 -05 11 :00 :59 1 13 102 0 2021 -10 -06 10 :00 :45 2021 -10 -06 11 :00 :55 1 （ uid - 用 户 ID,
-- artical_id - 文 章 ID,
-- in_time - 进 入 时 间,
-- out_time - 离 开 时 间,
-- sign_in - 是 否 签 到 ） 场 景 逻 辑 说 明 ： • artical_id - 文 章 ID 代 表 用 户 浏 览 的 文 章 的 ID ， 特 殊 情 况 artical_id - 文 章 ID 为 0 表 示 用 户 在 非 文 章 内 容 页 （ 比 如 App 内 的 列 表 页 、 活 动 页 等 ） 。 注 意 ： 只 有 artical_id 为 0 时 sign_in 值 才 有 效 。 • 从 2021 年 7 月 7 日 0 点 开 始 ， 用 户 每 天 签 到 可 以 领 1 金 币 ， 并 可 以 开 始 累 积 签 到 天 数 ， 连 续 签 到 的 第 3 、 7 天 分 别 可 额 外 领 2 、 6 金 币 。 • 每 连 续 签 到 7 天 后 重 新 累 积 签 到 天 数 （ 即 重 置 签 到 天 数 ： 连 续 第 8 天 签 到 时 记 为 新 的 一 轮 签 到 的 第 一 天 ， 领 1 金 币 ） 问 题 ： 计 算 每 个 用 户 2021 年 7 月 以 来 每 月 获 得 的 金 币 数 （ 该 活 动 到 10 月 底 结 束 ， 11 月 1 日 开 始 的 签 到 不 再 获 得 金 币 ） 。 结 果 按 月 份 、 ID 升 序 排 序 。 注 ： 如 果 签 到 记 录 的 in_time - 进 入 时 间 和 out_time - 离 开 时 间 跨 天 了 ， 也 只 记 作 in_time 对 应 的 日 期 签 到 了 。 输 出 示 例 ： 示 例 数 据 的 输 出 结 果 如 下 ： uid month coin 101 202107 15 102 202110 7 解 释 ： 101 在 活 动 期 内 连 续 签 到 了 7 天 ， 因 此 获 得 1 * 7 + 2 + 6 = 15 金 币 ； 102 在 10.01 ~ 10.03 连 续 签 到 3 天 获 得 5 金 币 10.04 断 签 了 ， 10.05 ~ 10.06 连 续 签 到 2 天 获 得 2 金 币 ， 共 得 到 7 金 币 。 示 例 1 输 入 ： DROP TABLE IF EXISTS tb_user_log;
-- CREATE TABLE tb_user_log (
--   id INT PRIMARY KEY AUTO_INCREMENT COMMENT '自增ID',
--   uid INT NOT NULL COMMENT '用户ID',
--   artical_id INT NOT NULL COMMENT '视频ID',
--   in_time datetime COMMENT '进入时间',
--   out_time datetime COMMENT '离开时间',
--   sign_in TINYINT DEFAULT 0 COMMENT '是否签到'
-- ) CHARACTER SET utf8 COLLATE utf8_bin;
-- INSERT INTO
--   tb_user_log(uid, artical_id, in_time, out_time, sign_in)
-- VALUES
--   (
--     101,
--     0,
--     '2021-07-07 10:00:00',
--     '2021-07-07 10:00:09',
--     1
--   ),
--   (
--     101,
--     0,
--     '2021-07-08 10:00:00',
--     '2021-07-08 10:00:09',
--     1
--   ),
--   (
--     101,
--     0,
--     '2021-07-09 10:00:00',
--     '2021-07-09 10:00:42',
--     1
--   ),
--   (
--     101,
--     0,
--     '2021-07-10 10:00:00',
--     '2021-07-10 10:00:09',
--     1
--   ),
--   (
--     101,
--     0,
--     '2021-07-11 23:59:55',
--     '2021-07-11 23:59:59',
--     1
--   ),
--   (
--     101,
--     0,
--     '2021-07-12 10:00:28',
--     '2021-07-12 10:00:50',
--     1
--   ),
--   (
--     101,
--     0,
--     '2021-07-13 10:00:28',
--     '2021-07-13 10:00:50',
--     1
--   ),
--   (
--     102,
--     0,
--     '2021-10-01 10:00:28',
--     '2021-10-01 10:00:50',
--     1
--   ),
--   (
--     102,
--     0,
--     '2021-10-02 10:00:01',
--     '2021-10-02 10:01:50',
--     1
--   ),
--   (
--     102,
--     0,
--     '2021-10-03 11:00:55',
--     '2021-10-03 11:00:59',
--     1
--   ),
--   (
--     102,
--     0,
--     '2021-10-04 11:00:45',
--     '2021-10-04 11:00:55',
--     0
--   ),
--   (
--     102,
--     0,
--     '2021-10-05 11:00:53',
--     '2021-10-05 11:00:59',
--     1
--   ),
--   (
--     102,
--     0,
--     '2021-10-06 11:00:45',
--     '2021-10-06 11:00:55',
--     1
--   );
-- 复 制 输 出 ： 101 | 202107 | 15 102 | 202110 | 7
with t1 as(
  select
    distinct uid,
    date(in_time) dt,
)